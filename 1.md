> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [www.volcengine.com](https://www.volcengine.com/docs/6561/1594356?lang=zh)

> 火山引擎官方文档中心，产品文档、快速入门、用户指南等内容，你关心的都在这里，包含火山引擎主要产品的使用手册、API 或 SDK 手册、常见问题等必备资料，我们会不断优化，为用户带来更好的使用体验

1 接口功能

豆包端到端实时语音大模型 API 即 RealtimeAPI 支持低延迟、多模式交互，可用于构建语音到语音的对话工具。该 API 支持中文和英语两大语种，目前只支持 WebSocket 协议连接到此 API，同时支持客户边发送数据边接收数据的流式交互方式。

1.1 产品约束
--------

1.  客户端上传音频格式要求 PCM（脉冲编码调制，未经压缩的的音频格式）、单声道、采样率 16000、每个采样点用`int16`表示、字节序为小端序。
2.  服务端返回的是 OGG 封装的 Opus 音频，兼顾压缩效率与传输性能。
3.  若客户端在 StartSession 事件中增加 TTS 配置，服务端可返回 PCM 格式的音频流（单声道、24000Hz 采样率、Float32 采样点、小端序）。具体请求参数如下所示：

```
{
    "tts" : {
        "audio_config": {
            "channel": 1,
            "format": "pcm",
            "sample_rate": 24000
        }
    }
}


```

4.  限流条件分为 QPM 和 TPM，QPM 全称 query per minute，这里的 query 对应 StartSession 事件，即在一个 AppID 下面每分钟的 StartSession 事件不能超过配额值。TPM 全称 tokens per minute，即一分钟所消耗的全部 token 不能超过对应的配额值。

1.2 最佳实践
--------

1.  实时对话采用流式输入输出架构，即便用户未发起 query，客户端也需持续发送音频，以维持流式处理链路的正常运行。
2.  在客户端发送 FinishSession 事件后，系统将不再返回任何事件。但客户端仍可复用与火山语音网关之间的 WebSocket 连接。若需发起新的会话，客户端需重新从 StartSession 事件开始。

![](https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/792768cc8d2f4be7b74cae61b9f1b722~tplv-goo7wpa0wc-image.image)

3.  在没有对话需求时候，可以发送 FinishSession 事件结束会话。如果不想复用 websocket 连接，可以继续发送 FinishConnection 事件，释放对应的 websocket 连接。
4.  推荐客户端在事件的 optional 字段中携带 event 和 session ID，以降低开发成本，并将事件处理的复杂性交由火山语音服务端负责。
5.  客户在集成端到端语音合成模型过程中，使用 ChatTTSText 进行音频合成请求的最佳实践方法，其中黄色部分需要客户实现：

![](https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/e00fc94e88ca485ab8a8b2c107552ed3~tplv-goo7wpa0wc-image.image)

2 接口说明

WebSocket 是一种广泛支持的实时数据传输 API，也是服务器应用程序中连接到豆包端到端实时语音大模型 API 的最佳选择。在客户服务器上集成此 API 时候，可以通过 WebSocket 直接连接到实时语音大模型 API，具体鉴权参数可以在火山控制台获取。  

2.1 ws 连接详细信息
-------------

*   通过 WebSocket 建立连接需要以下连接信息：

<table><thead><tr><th><p>URL</p></th><th colspan="4"><p>wss://openspeech.bytedance.com/api/v3/realtime/dialogue</p></th></tr></thead><tbody><tr><td rowspan="6"><p>Request Headers</p></td><td><p>Key</p></td><td><p>说明</p></td><td><p>是否必须</p></td><td><p>Value 示例</p></td></tr><tr><td><p>X-Api-App-ID</p></td><td><p>使用火山引擎控制台获取的 APP ID，可参考 <a href="https://www.volcengine.com/docs/6561/196768#q1%EF%BC%9A%E5%93%AA%E9%87%8C%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%8F%96%E5%88%B0%E4%BB%A5%E4%B8%8B%E5%8F%82%E6%95%B0appid%EF%BC%8Ccluster%EF%BC%8Ctoken%EF%BC%8Cauthorization-type%EF%BC%8Csecret-key-%EF%BC%9F" target="_blank" rel="noreferrer">控制台使用 FAQ-Q1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></td><td><p>是</p></td><td><p>123456789</p></td></tr><tr><td><p>X-Api-Access-Key</p></td><td><p>使用火山引擎控制台获取的 Access Token，可参考 <a href="https://www.volcengine.com/docs/6561/196768#q1%EF%BC%9A%E5%93%AA%E9%87%8C%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%8F%96%E5%88%B0%E4%BB%A5%E4%B8%8B%E5%8F%82%E6%95%B0appid%EF%BC%8Ccluster%EF%BC%8Ctoken%EF%BC%8Cauthorization-type%EF%BC%8Csecret-key-%EF%BC%9F" target="_blank" rel="noreferrer">控制台使用 FAQ-Q1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></td><td><p>是</p></td><td><p>your-access-key</p></td></tr><tr><td><p>X-Api-Resource-Id</p></td><td><p>表示调用服务的资源信息 ID<br>固定值：volc.speech.dialog</p></td><td><p>是</p></td><td><p>volc.speech.dialog</p></td></tr><tr><td><p>X-Api-App-Key</p></td><td><p>固定值</p></td><td><p>是</p></td><td><p>PlgvMymc7f3tQnJ6</p></td></tr><tr><td><p>X-Api-Connect-Id</p></td><td><p>用于追踪当前连接情况的标志 ID<br>建议用户传递，便于排查连接情况</p></td><td><p>否</p></td><td><p>d1dcd999-9a9e-4ed6-b227-8649e946f6c4</p></td></tr></tbody></table>

*   在 websocket 握手成功后，会返回如下 Response header

<table><thead><tr><th><p>Key</p></th><th><p>说明</p></th><th><p>Value 示例</p></th></tr></thead><tbody><tr><td><p>X-Tt-Logid</p></td><td><p>服务端返回的 logid，建议用户获取和打印方便定位问题</p></td><td><p>20250506234111719BC62BBA7C4C0C635A</p></td></tr></tbody></table>

2.2 WebSocket 二进制协议
-------------------

豆包端到端实时语音大模型 API 使用二进制协议传输数据，协议由 4 字节的 header、optioanl、payload size 和 payload 三部分组成，其中：

*   header 用于描述消息类型、序列化方式以及压缩格式等信息
*   optional 可选字段
    *   sequence 字段
    *   event 字段，用于描述链接过程中状态管理的预定义事件
    *   connect id size/ connect id 字段，用于描述连接类事件的标识
    *   session id size/ session id 字段，用于描述会话类事件的标识
    *   error code: 仅用于错误帧，描述错误信息
*   payload size 代表 payload 的长度
*   payload 是具体负载的内容，依据不同的消息类型装载不同的内容

<table><thead><tr><th><p>Byte</p></th><th><p>Left-4bit</p></th><th><p>Right-4bit</p></th><th><p>说明</p></th></tr></thead><tbody><tr><td rowspan="2"><p>0</p></td><td><p>Protocol Version</p></td><td></td><td><p>目前只有 v1，固定 0b0001</p></td></tr><tr><td></td><td><p>Header Size</p></td><td><p>目前只有 4 字节固定 0b0001</p></td></tr><tr><td><p>1</p></td><td><p>Message Type</p></td><td><p>Message type specific flags</p></td><td><p>详细见下面消息说明</p></td></tr><tr><td rowspan="2"><p>2</p></td><td><p>Serialization method</p></td><td></td><td><ul><li>0b0000：Raw（无特殊序列化，主要针对二进制音频数据）</li><li>0b0001：JSON（主要针对文本类型消息）</li></ul></td></tr><tr><td></td><td><p>Compression method</p></td><td><ul><li>0b0000：无压缩（<strong>推荐</strong>）</li><li>0b0001：gzip</li></ul></td></tr><tr><td><p>3</p></td><td colspan="2"><p>0x00</p></td><td><p>Reserved</p></td></tr></tbody></table>

#### Mesage Type

<table><thead><tr><th><p>Message Type</p></th><th><p>含义</p></th><th><p>说明</p></th></tr></thead><tbody><tr><td><p>0b0001</p></td><td><p>Full-client request</p></td><td><p>客户端发送文本事件的消息类型</p></td></tr><tr><td><p>0b1001</p></td><td><p>Full-server response</p></td><td><p>服务器返回的文本事件的消息类型</p></td></tr><tr><td><p>0b0010</p></td><td><p>Audio-only request</p></td><td><p>客户端发送音频数据的消息类型</p></td></tr><tr><td><p>0b1011</p></td><td><p>Audio-only response</p></td><td><p>服务器返回音频数据的消息类型</p></td></tr><tr><td><p>0b1111</p></td><td><p>Error information</p></td><td><p>服务器返回的错误事件的消息类型</p></td></tr></tbody></table>

### Message type specific flags

Optional 可选字段 code、sequence、event 取决于 Message type specific flags，而 connect id 和 session id 取决于事件类型。如果设置对应 flag 请**按照表格顺序**进行二进制组装。目前支持的全集如下所示：

<table><thead><tr><th><p>字段</p></th><th><p>长度（Byte）</p></th><th><p>说明</p></th><th><p>Message type specific flags</p></th></tr></thead><tbody><tr><td><p>code</p></td><td><p>4</p></td><td><p>【可选】错误码 code</p></td><td><ul><li>0b1111：错误帧</li></ul></td></tr><tr><td><p>sequence</p></td><td><p>4</p></td><td><p>【可选】描述客户端的事件序号</p></td><td><ul><li>0b0000：没有 sequence 字段</li><li>0b0001：序号大于 0 的非终端数据包</li><li>0b0010：最后一个无序号的数据包</li><li>0b0011：最后一个序号小于 0 的数据包，一般用 - 1 表示</li></ul></td></tr><tr><td><p>event</p></td><td><p>4</p></td><td><p>【必须】描述连接过程中状态管理的预定义事件，详细参考<a href="https://www.volcengine.com/docs/6561/1594356#_2-3-%E5%AE%9E%E6%97%B6%E5%AF%B9%E8%AF%9D%E4%BA%8B%E4%BB%B6" target="_blank" rel="noreferrer">实时对话事件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中的事件 ID</p></td><td><ul><li>0b0100：携带事件 ID</li></ul></td></tr><tr><td><p>connect id size</p></td><td><p>4</p></td><td><p>【可选】客户事件携带的 connect id 对应的长度，只有 Connect 事件才能携带此字段</p></td><td rowspan="4"><p>——</p></td></tr><tr><td><p>connect id</p></td><td><p>取决于 connect id size</p></td><td><p>【可选】客户生成的 connect id</p></td></tr><tr><td><p>session id size</p></td><td><p>4</p></td><td><p>【必须】客户事件携带的 session id 对应的长度，只有 Session 级别的事件携带此字段</p></td></tr><tr><td><p>session id</p></td><td><p>取决于 session id size</p></td><td><p>【必须】客户事件携带的 session id</p></td></tr></tbody></table>

### 具体的 payload size 和 payload

payload 可以放音频二进制数据，也可以放类似 StartSession 事件中的 json 数据。

<table><thead><tr><th><p>字段</p></th><th><p>长度（Byte）</p></th><th><p>说明</p></th></tr></thead><tbody><tr><td><p>payload size</p></td><td><p>4</p></td><td><p>paylaod 长度</p></td></tr><tr><td><p>payload</p></td><td><p>长度取决于 payload size</p></td><td><p>payload 内容，可以是二进制音频数据，也可以是 json 字符串</p></td></tr></tbody></table>

#### 错误帧 payload

```
{
    "error": {{STRING}}
}


```

2.3 实时对话事件
----------

通过 WebSocket 连接到豆包端到端实时语音大模型 API 之后，可以调用`S2S模型`进行语音到语音的对话。需要**发送客户端事件**来启动操作，并**监听服务器事件**以采取对应的操作。  

### 客户端事件

<table><thead><tr><th><p>事件 ID</p></th><th><p>事件定义</p></th><th><p>事件类型</p></th><th><p>说明</p></th><th><p>示例</p></th></tr></thead><tbody><tr><td><p>1</p></td><td><p>StartConnection</p></td><td rowspan="2"><p>Connect 类事件</p></td><td><p>Websocket 阶段申明创建连接</p></td><td rowspan="2"><pre>{}

</pre></td></tr><tr><td><p>2</p></td><td><p>FinishConnection</p></td><td><p>断开 websocket 连接，后面需要重新发起 websocket 连接</p></td></tr><tr><td><p>100</p></td><td><p>StartSession</p></td><td rowspan="5"><p>Session 类事件</p></td><td><p>Websocket 阶段申明创建会话，其中：</p><ul><li>bot_name 字段用于修改基础人设信息，例如人名、来源等，默认为豆包</li><li>system_role 字段用于配置背景人设信息，描述角色的来源、设定等，例如 “你是大灰狼、用户是小红帽，用户逃跑时你会威胁吃掉他。”</li><li>speaking_style 字段用于配置模型对话风格，例如 “你说话偏向林黛玉。”、“你口吻拽拽的。” 等</li><li>长度限制：bot_name 最长不超过 20 个字符，system_role 与 speaking_style 合计不得超过 1500 个字符</li><li>dialog_id 字段用于加载相同 dialog id 的 session 对话记录，进而提升模型回复能力</li><li>strict_audit 字段用于声明安全审核等级，true 代表严格审核、false 代表普通审核，默认为 true</li><li>audit_response 字段用于指定用户 query 命中安全审核之后的自定义回复话术</li></ul></td><td><pre>{
    "dialog": {
        "bot_name": {{STRING}},
        "system_role": {{STRING}},
        "speaking_style": {{STRING}},
        "dialog_id": {{STRING}},
        "extra" : {
            "strict_audit": {{BOOLEAN}},
            "audit_response": {{STRING}}
        }
    }
}

</pre></td></tr><tr><td><p>102</p></td><td><p>FinishSession</p></td><td><p>客户端声明结束会话，后面可以复用 websocket 连接</p></td><td><pre>{}

</pre></td></tr><tr><td><p>200</p></td><td><p>TaskRequest</p></td><td><p>客户端上传音频</p></td><td><p>音频二进制数据</p></td></tr><tr><td><p>300</p></td><td><p>SayHello</p></td><td><p>客户端提交打招呼文本</p></td><td><pre>{
    "content": {{STRING}}
}

</pre></td></tr><tr><td><p>500</p></td><td><p>ChatTTSText</p></td><td><p>用户 query 之后，模型会生成闲聊结果。如果客户判断用户 query 不需要闲聊结果，可以指定文本合成音频</p></td><td><pre>{
    "start": {{BOOLEAN}},
    "content": {{STRING}},
    "end": {{BOOLEAN}}
}

</pre></td></tr></tbody></table>

备注：

*   Websocket 阶段：在 HTTP 建立连接之后 Upgrade
*   客户端在发送 FinishSession 事件之后，websocket 连接不会断开，客户端可以继续复用，复用时候需要再发送一次 StartSession 事件，即重新初始化会话
*   Message Type = 0b0001，Message type specific flags = 0b0100，StartConnection 事件二进制帧对应的字节数组示例：
    *   [17 20 16 0 0 0 0 1 0 0 0 2 123 125]
*   Message Type = 0b0001，Message type specific flags = 0b0100，SessionID = 75a6126e-427f-49a1-a2c1-621143cb9db3，jsonPayload = {"dialog":{"bot_name":"豆包","dialog_id":"","extra":null}}，StartSession 事件二进制帧对应的字节数组示例：

```
[17 20 16 0 0 0 0 100 0 0 0 36 55 53 97 54 49 50 54 101 45 52 50 55 102 45 52 57 97 49 45 97 50 99 49 45 54 50 49 49 52 51 99 98 57 100 98 51 0 0 0 60 123 34 100 105 97 108 111 103 34 58 123 34 98 111 116 95 110 97 109 101 34 58 34 232 177 134 229 140 133 34 44 34 100 105 97 108 111 103 95 105 100 34 58 34 34 44 34 101 120 116 114 97 34 58 110 117 108 108 125 125]


```

*   ChatTTSText 事件请求示例：
    *   第一包 json 示例

```
{
    "start": true,
    "content": "今天是",
    "end": false
}


```

*   中间包，用于流式上传待合成音频的文本

```
{
    "start": false,
    "content": "星期二。",
    "end": false
}


```

*   最后一包，若在音频播报过程中发起新的 query 导致中断，且合成音频的 end 包尚未发送，此时无需再下发该 end 包，以避免多余流程或状态异常。

```
{
    "start": false,
    "content": "",
    "end": true
}


```

### 服务端事件

<table><thead><tr><th><p>事件 ID</p></th><th><p>事件定义</p></th><th><p>事件类型</p></th><th><p>说明</p></th><th><p>示例</p></th></tr></thead><tbody><tr><td><p>50</p></td><td><p>ConnectionStarted</p></td><td rowspan="3"><p>Connect 类</p></td><td><p>成功建立连接</p></td><td><pre>{}

</pre></td></tr><tr><td><p>51</p></td><td><p>ConnectionFailed</p></td><td><p>建立连接失败</p></td><td><pre>{
    "error": {{STRING}}
}

</pre></td></tr><tr><td><p>52</p></td><td><p>ConnectionFinished</p></td><td><p>连接结束</p></td><td><pre>{}

</pre></td></tr><tr><td><p>150</p></td><td><p>SessionStarted</p></td><td rowspan="12"><p>Session 类</p></td><td><p>成功启动会话，返回的 dialog id 用于接续最近的对话内容，增加模型智能度</p></td><td><pre>{
    "dialog_id": {{STRING}}
}

</pre></td></tr><tr><td><p>152</p></td><td><p>SessionFinished</p></td><td><p>会话已结束</p></td><td><pre>{}

</pre></td></tr><tr><td><p>153</p></td><td><p>SessionFailed</p></td><td><p>会话失败</p></td><td><pre>{
    "error": {{STRING}}
}

</pre></td></tr><tr><td><p>350</p></td><td><p>TTSSentenceStart</p></td><td><p>合成音频的起始事件，tts_type 取值类型有：</p><ul><li>audit_content_risky（命中安全审核音频）</li><li>chat_tts_text（客户文本合成音频）</li><li>default（闲聊音频）</li></ul></td><td><pre>{
    "tts_type": {{STRING}},
    "text" : {{STRING}},
}

</pre></td></tr><tr><td><p>351</p></td><td><p>TTSSentenceEnd</p></td><td><p>合成音频的分句结束事件</p></td><td><pre>{}

</pre></td></tr><tr><td><p>352</p></td><td><p>TTSResponse</p></td><td><p>返回模型生成的音频数据</p></td><td><p>payload 装载二进制音频数据</p></td></tr><tr><td><p>359</p></td><td><p>TTSEnded</p></td><td><p>模型一轮音频合成结束事件</p></td><td rowspan="2"><pre>{}

</pre></td></tr><tr><td><p>450</p></td><td><p>ASRInfo</p></td><td><p>模型识别出音频流中的首字返回的事件，用于打断客户端的播报</p></td></tr><tr><td><p>451</p></td><td><p>ASRResponse</p></td><td><p>模型识别出用户说话的文本内容</p></td><td><pre>{
    "results": [
      {
        "text": {{STRING}},
        "is_interim": {{BOOLEAN}}
      }
    ]
}

</pre></td></tr><tr><td><p>459</p></td><td><p>ASREnded</p></td><td><p>模型认为用户说话结束的事件</p></td><td><pre>{}

</pre></td></tr><tr><td><p>550</p></td><td><p>ChatResponse</p></td><td><p>模型回复的文本内容</p></td><td><pre>{
  "content": {{STRING}},
}

</pre></td></tr><tr><td><p>559</p></td><td><p>ChatEnded</p></td><td><p>模型回复文本结束事件</p></td><td><pre>{}

</pre></td></tr></tbody></table>

备注：

*   服务器事件中 json paylod 可能会多返回一些字段，客户端无需关心
*   Message type specific flags = 0b0100，session id =3c791a7d-227a-4446-993b-24f9e302cc98，TTSResponse 事件示例：
    *   [17 180 0 0 0 0 1 96 0 0 0 36 51 99 55 57 49 97 55 100 45 50 50 55 97 45 52 52 52 54 45 57 57 51 98 45 50 52 102 57 101 51 48 50 99 99 57 56 0 0 7 252 79 103 103 83 0 0 64 129 32 0 0 0 0 0 132 149 185 182 172 8 0 0 169 57 249 174 1 71 104 139 98 229 167 232 122 108 0 183 60 54 43 137 197 126 20 248 201 174]

3 快速开始

Python 示例
---------

![](data:image/png;base64,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)

![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAYCAYAAADzoH0MAAAABGdBTUEAALGPC/xhBQAAAHxJREFUOBHtUlsOgCAMAy8uPk7tj7YETFwGOBPDhzYZbKMrC8y7MnZx5EUcw0FLWnL9BSzdvsNVXzZd9ZVf6D8HfwfO8Q1G2KZYGshz0zisjVixcnQtxpoLFkR3BchVMSPbEiGnippIszgrT3BkJ8yZEMDOIvQfIaCKVsQBup49zbP0w5sAAAAASUVORK5CYII=)

Go 示例
-----

![](data:image/png;base64,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)

![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAYCAYAAADzoH0MAAAABGdBTUEAALGPC/xhBQAAAHxJREFUOBHtUlsOgCAMAy8uPk7tj7YETFwGOBPDhzYZbKMrC8y7MnZx5EUcw0FLWnL9BSzdvsNVXzZd9ZVf6D8HfwfO8Q1G2KZYGshz0zisjVixcnQtxpoLFkR3BchVMSPbEiGnippIszgrT3BkJ8yZEMDOIvQfIaCKVsQBup49zbP0w5sAAAAASUVORK5CYII=)

您可以通过以下步骤，快速体验与 Realtime 模型 API 实时对话的功能。

1.  下载 realtime_dialog.zip 文件到本地，依据操作系统类型对`gordonklaus/portaudio`依赖进行安装：
    1.  macOS：

```
brew install portaudio


```

2.  CentOS：

```
sudo yum install -y portaudio portaudio-devel


```

3.  Debian/Ubuntu：

```
sudo apt-get install portaudio19-dev


```

2.  安装后在项目下运行：

```
go执行命令：go run . -v=0
python执行命令：python main.py


```

4 交互示例

RealtimeAPI 的交互流程目前只支持 server_vad 模式，该模式的交互流程如下：

1.  客户端发送 StartSession 事件初始化会话
2.  客户端可以随时通过 TaskRequest 事件将音频发送到服务端
3.  服务端在检测到用户说话的时候，会返回 ASRInfo 和 ASRResponse 事件，同时在检测到用户说话结束之后返回 ASREnded 事件
4.  服务端合成的音频通过 TTSResponse 事件将音频返回给客户端

![](https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/48ba02413863450db726bd556e866981~tplv-goo7wpa0wc-image.image)

4.1 合成音频
--------

当客户判定不使用模型生成闲聊内容时，系统允许客户多次上传文本执行音频合成，以满足多样化需求。整体交互示例如下所示：  
![](https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/f2a8516c2b6045f48890cbac1fc80ca6~tplv-goo7wpa0wc-image.image)

5 错误码

<table><thead><tr><th><p>类型</p></th><th><p>错误码</p></th><th><p>错误定义</p></th><th><p>说明</p></th></tr></thead><tbody><tr><td rowspan="2"><p>客户端</p></td><td><p>45000002</p></td><td><p>Empty audio</p></td><td><p>客户上传空的音频包，即 TaskRequest 事件中的音频长度为 0</p></td></tr><tr><td><p>45000003</p></td><td><p>Abnormal silence audio</p></td><td><p>10 分钟静音释放链接</p></td></tr><tr><td rowspan="5"><p>服务端</p></td><td rowspan="3"><p>55000001</p></td><td rowspan="3"><p>Server processing error</p></td><td><p>服务端超过 10 秒没有收到 query 音频（客户端想要保持链接需要一直发送静音音频）</p></td></tr><tr><td><p>下游服务超过 35 秒没有收到 tts 回复</p></td></tr><tr><td><p>服务端处理错误（通用型错误，需要借助 logid 进行深入排查）</p></td></tr><tr><td><p>55000030</p></td><td><p>Service unavailable</p></td><td><p>下游模块建立连接失败</p></td></tr><tr><td><p>55002070</p></td><td><p>AudioFlow error</p></td><td><p>下游返回错误信息，统一对外的错误码</p></td></tr></tbody></table>

6. 文档修订记录

<table><thead><tr><th><p>日期</p></th><th><p>update</p></th></tr></thead><tbody><tr><td><p>25.07.14</p></td><td><p>支持客户自定义用户 query 命中安全审核时候的回复话术，新增 audit_response 字段</p></td></tr><tr><td><p>25.07.09</p></td><td><p>go 示例修复一个 tts 音色配置 bug</p></td></tr><tr><td><p>25.07.03</p></td><td><p>python 示例开放模型人设区域，提升端到端模型自定义能力；增加 SayHello、ChatTTSText 事件发送示例；</p></td></tr><tr><td><p>25.07.01</p></td><td><p>客户端在发送 ChatTTSText 事件时候一定要在收到 ASREnded 事件之后；增加一些报错处理，例如 appkey 错误、sp 配置长度超过限制；</p></td></tr><tr><td><p>25.06.25</p></td><td><p>Go 示例开放模型人设区域，提升端到端模型自定义能力；增加 SayHello、ChatTTSText 事件发送示例；</p></td></tr><tr><td><p>25.06.10</p></td><td><p>更新 realtime_dialog 示例，用户 query 打断本地播放音频</p></td></tr><tr><td><p>25.06.05</p></td><td><p>更新 realtime_dialog 示例，ctrl+c 之后发送 FinishSession、FinishConnection 事件之后，再调用 close 断开 websocket 连接</p></td></tr><tr><td><p>25.06.05</p></td><td><p>补充客户接入 ChatTTSText 的最佳实践</p></td></tr><tr><td><p>25.06.04</p></td><td><p>删除服务端返回的 UsageResponse 事件，客户可以在火山控制台查看用量</p></td></tr><tr><td><p>25.06.04</p></td><td><p>更新 realtime_dialog Go 示例 demo，新增 sayHello、chatTTSTesxt 数据构造示例</p></td></tr><tr><td><p>25.06.03</p></td><td><p>新增 realtime_dialog Python 示例 demo</p></td></tr><tr><td><p>25.05.30</p></td><td><p>更新 realtime_dialog 示例，新增 pcm 保存到文件代码示例</p></td></tr><tr><td><p>25.05.30</p></td><td><p>更新 Message type specific flags 说明，注明必须传的字段</p></td></tr><tr><td><p>25.05.28</p></td><td><p>更新 realtime_dialog Go 示例 demo，修复录音上传慢问题</p></td></tr></tbody></table>